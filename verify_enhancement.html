<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="utf-8">
    <title>æ‹¡å¼µæ©Ÿèƒ½ç¢ºèª: æ±äº¬â†’æ±æµ·é“ç·šâ†’ç¥æˆ¸â†’å±±é™½ç·šâ†’ä¸‹é–¢</title>
    <style>
        body { font-family: monospace; margin: 20px; }
        .pass { color: green; }
        .fail { color: red; }
        .info { color: blue; }
    </style>
</head>
<body>
    <h1>ğŸš„ æ‹¡å¼µæ©Ÿèƒ½ç¢ºèªãƒ†ã‚¹ãƒˆ</h1>
    <p>çµŒè·¯: <strong>æ±äº¬ â†’ æ±æµ·é“ç·š â†’ ç¥æˆ¸ â†’ å±±é™½ç·š â†’ ä¸‹é–¢</strong></p>
    
    <button onclick="verifyEnhancements()">ğŸ§ª æ‹¡å¼µæ©Ÿèƒ½ç¢ºèª</button>
    <button onclick="location.href='test_route_detailed.html'">ğŸ“‹ è©³ç´°ãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸</button>
    <button onclick="location.href='farert_test.html'">ğŸ  ãƒ¡ã‚¤ãƒ³ãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸</button>
    
    <div id="results"></div>

    <script>
        let moduleReady = false;
        let FarertModule = null;

        function log(message, className = 'info') {
            const div = document.createElement('div');
            div.className = className;
            div.textContent = new Date().toLocaleTimeString() + ' - ' + message;
            document.getElementById('results').appendChild(div);
        }

        async function loadModule() {
            try {
                log('WebAssemblyãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«èª­ã¿è¾¼ã¿ä¸­...');
                const module = await import('./dist/farert.js');
                FarertModule = await module.default();
                moduleReady = true;
                log('âœ… ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«èª­ã¿è¾¼ã¿å®Œäº†', 'pass');
            } catch (error) {
                log('âŒ ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«èª­ã¿è¾¼ã¿å¤±æ•—: ' + error.message, 'fail');
            }
        }

        async function verifyEnhancements() {
            if (!moduleReady) {
                await loadModule();
                if (!moduleReady) return;
            }
            
            document.getElementById('results').innerHTML = '';
            
            try {
                // ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶š
                FarertModule.openDatabase();
                log('âœ… ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶š', 'pass');
                
                // æŒ‡å®šã•ã‚ŒãŸé§…ã®ãƒ†ã‚¹ãƒˆ
                const stations = ['æ±äº¬', 'ç¥æˆ¸', 'ä¸‹é–¢'];
                log('=== æŒ‡å®šé§…æ¤œç´¢ãƒ†ã‚¹ãƒˆ ===', 'info');
                
                for (const station of stations) {
                    const id = FarertModule.getStationId(station);
                    const name = id > 0 ? FarertModule.getStationName(id) : '';
                    log(`${station}: ID=${id}, å–å¾—å="${name}"`, id > 0 ? 'pass' : 'fail');
                }
                
                // é–¢é€£è·¯ç·šã®æ¤œç´¢
                log('=== é–¢é€£è·¯ç·šæ¤œç´¢ãƒ†ã‚¹ãƒˆ ===', 'info');
                let tokaido = false, sanyo = false;
                
                for (let lineId = 1; lineId <= 20; lineId++) {
                    const lineName = FarertModule.getLineName(lineId);
                    if (lineName && lineName.length > 0) {
                        if (lineName.includes('æ±æµ·é“')) {
                            log(`æ±æµ·é“ç·šç™ºè¦‹: ID=${lineId}, åå‰="${lineName}"`, 'pass');
                            tokaido = true;
                        } else if (lineName.includes('å±±é™½')) {
                            log(`å±±é™½ç·šç™ºè¦‹: ID=${lineId}, åå‰="${lineName}"`, 'pass');
                            sanyo = true;
                        }
                    }
                }
                
                // çµŒè·¯ä½œæˆãƒ†ã‚¹ãƒˆ
                log('=== çµŒè·¯ä½œæˆãƒ†ã‚¹ãƒˆ ===', 'info');
                const routeCreated = FarertModule.createRoute();
                log(`çµŒè·¯ä½œæˆ: ${routeCreated === 1 ? 'æˆåŠŸ' : 'å¤±æ•—'}`, routeCreated === 1 ? 'pass' : 'fail');
                
                // é§…è¿½åŠ ãƒ†ã‚¹ãƒˆ
                if (routeCreated === 1) {
                    for (const station of stations) {
                        const id = FarertModule.getStationId(station);
                        if (id > 0) {
                            const result = FarertModule.addStation(id);
                            log(`${station}é§…è¿½åŠ : ${result >= 0 ? 'æˆåŠŸ' : 'å¤±æ•—'}`, result >= 0 ? 'pass' : 'fail');
                        }
                    }
                    
                    const routeCount = FarertModule.getRouteCount();
                    log(`çµŒè·¯é§…æ•°: ${routeCount}`, 'info');
                    
                    // é‹è³ƒè¨ˆç®—
                    const fare = FarertModule.calculateFare();
                    const fareString = FarertModule.getFareString();
                    log(`é‹è³ƒè¨ˆç®—: ${fare >= 0 ? 'æˆåŠŸ' : 'å¤±æ•—'}`, fare >= 0 ? 'pass' : 'fail');
                    log(`é‹è³ƒæƒ…å ±: "${fareString}"`, 'info');
                }
                
                log('ğŸ‰ æ‹¡å¼µæ©Ÿèƒ½ç¢ºèªå®Œäº†ï¼', 'pass');
                log('ğŸ’¡ è©³ç´°ãªãƒ†ã‚¹ãƒˆã¯ã€Œè©³ç´°ãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸ã€ã§å®Ÿè¡Œã—ã¦ãã ã•ã„', 'info');
                
            } catch (error) {
                log('âŒ ã‚¨ãƒ©ãƒ¼: ' + error.message, 'fail');
            }
        }

        window.addEventListener('load', loadModule);
    </script>
</body>
</html>